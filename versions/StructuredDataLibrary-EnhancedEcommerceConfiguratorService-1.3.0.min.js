class ConfiguratorChoiceSelector{constructor(e,t,i){this.selector=e,this.eventType=t,this.onPriceCalculated=i}}class ConfiguratorInstructionSelector{constructor(e,t){this.selector=e,this.eventType=t}}class ChoiceEventSettings{constructor(e=[],t=null,i=[],r=null){this.configuratorChoiceSelectors=e,this.getChoiceMadeSchema=t,this.configuratorInstructionSelectors=i,this.getInstructionSchema=r}}class ErrorEventSettings{constructor(e,t){this.nextButtonSelector=e,this.getErrorSchemas=t}}class EnhancedEcommerceConfiguratorService extends EnhancedEcommerceService{constructor(e,t,i,r,s,n,a=null,o=null){super(),this.lastEvent="",this.currentStep=1,this.boundEventListeners=[],this.stepChanged=!1,this.choiceMadeForPriceCalculated=!1,this.configuratorType=e,this.getVirtualPageviewSchema=t,this.getStepCompleteSchema=i,this.getSummarySchema=r,this.getAddToBasketSchema=s,this.getPathChanged=n,this.choiceEventSettings=a,this.errorEventSettings=o,this.eventNames={errorMessage:"ErrorMessage",nextStep:"Volgende stap",previousStep:"Vorige stap",summary:"Samenvatting",addedToBasket:"Stap {currentStep} afgerond - {configuratorType}",virtualPageview:"VirtualPageview",stepComplete:"Stap {currentStep} afgerond - {configuratorType}",informationIcon:"Informatie icoon",choicesMade:"Keuzes stap {currentStep} - {configuratorType}"},this.privateInit()}privateInit(){this.privatePushVirtualPageview(this.currentStep),this.privateInitBindings()}privateInitBindings(){this.privateBindChoices(),this.privateBindErrorsOnNext(),document.addEventListener("jconfiguratorStepLoaded",this.privateStepChanged.bind(this)),document.addEventListener("jconfiguratorStepRendered",this.privateBindChoices.bind(this)),document.addEventListener("jconfiguratorSubStepRendered",this.privateBindChoices.bind(this)),document.addEventListener("jconfiguratorSummaryLoaded",this.privateSummaryLoaded.bind(this)),document.addEventListener("jconfiguratorAddToBasket",this.privateAddedToBasket.bind(this)),document.addEventListener("jconfiguratorAfterCalculateTotalPrice",this.privatePriceCalculated.bind(this))}privateBindErrorsOnNext(){null!=this.errorEventSettings&&document.querySelectorAll(this.errorEventSettings.nextButtonSelector).forEach((e=>{e.addEventListener("click",(()=>{setTimeout((()=>{this.errorEventSettings.getErrorSchemas(this.currentStep,this.configuratorType).forEach((e=>{this.privatePushConfiguratorEvent(this.eventNames.errorMessage,e)}))}),100)}))}))}privateStepChanged(){this.stepChanged=!0;const e=parseInt(new URLSearchParams(window.location.search).get("confloc").split("-")[0]);this.privatePushVirtualPageview(e),this.privateNextPreviousStep(e),this.privateBindErrorsOnNext()}privateNextPreviousStep(e){e<this.currentStep?this.privatePushConfiguratorEvent(this.eventNames.previousStep,this.getPathChanged(this.currentStep,e)):e>this.currentStep&&this.privatePushConfiguratorEvent(this.eventNames.nextStep,this.getPathChanged(this.currentStep,e))}privatePushConfiguratorEvent(e,t,i=document){const r=JSON.stringify(t.getData(i));this.lastEvent!==r&&this._pushCustomEvent(e,t,i),this.lastEvent=r}privateSummaryLoaded(){this.privatePushVirtualPageview(this.currentStep+1),this.privateNextPreviousStep(this.currentStep+1),this.privatePushStepComplete(this.currentStep+1),this.privatePushConfiguratorEvent(this.eventNames.summary,this.getSummarySchema())}privateAddedToBasket(){const e=this.eventNames.addedToBasket.replace("{currentStep}",this.currentStep).replace("{configuratorType}",this.configuratorType);this.privatePushConfiguratorEvent(e,this.getAddToBasketSchema(this.currentStep))}privatePushVirtualPageview(e){this.privatePushConfiguratorEvent(this.eventNames.virtualPageview,this.getVirtualPageviewSchema(e))}privatePriceCalculated(){this.choiceMadeForPriceCalculated&&(this.choiceMadeForPriceCalculated=!1,this.privatePushChoiceMade(null)),this.stepChanged&&(this.stepChanged=!1,this.privatePushStepComplete(parseInt(new URLSearchParams(window.location.search).get("confloc").split("-")[0])))}privatePushStepComplete(e){if(this.currentStep<e){const e=this.eventNames.stepComplete.replace("{currentStep}",this.currentStep).replace("{configuratorType}",this.configuratorType);this.privatePushConfiguratorEvent(e,this.getStepCompleteSchema(this.currentStep))}this.currentStep=e}privateBindChoices(){null!=this.choiceEventSettings&&(this.boundEventListeners.forEach((e=>{e.removeEvent()})),this.boundEventListeners=[],null!=this.choiceEventSettings.configuratorChoiceSelectors&&this.choiceEventSettings.configuratorChoiceSelectors.length>0&&null!=this.choiceEventSettings.getChoiceMadeSchema&&this.choiceEventSettings.configuratorChoiceSelectors.forEach((e=>{document.querySelectorAll(e.selector).forEach((t=>{const i=e.onPriceCalculated?this.privatePushChoiceMadeDelayed.bind(this):this.privatePushChoiceMade.bind(this);t.addEventListener(e.eventType,i),this.boundEventListeners.push(new BoundEventListener(t,i,e.eventType))}))})),null!=this.choiceEventSettings.configuratorInstructionSelectors&&this.choiceEventSettings.configuratorInstructionSelectors.length>0&&null!=this.choiceEventSettings.getInstructionSchema&&this.choiceEventSettings.configuratorInstructionSelectors.forEach((e=>{document.querySelectorAll(e.selector).forEach((t=>{const event=()=>{this.privatePushConfiguratorEvent(this.eventNames.informationIcon,this.choiceEventSettings.getInstructionSchema(this.currentStep,this.configuratorType,t))};t.addEventListener(e.eventType,event),this.boundEventListeners.push(new BoundEventListener(t,event,e.eventType))}))})))}privatePushChoiceMade(e){const t=this.eventNames.choicesMade.replace("{currentStep}",this.currentStep).replace("{configuratorType}",this.configuratorType);this.privatePushConfiguratorEvent(t,this.choiceEventSettings.getChoiceMadeSchema(this.currentStep,null==e?null:e.currentTarget))}privatePushChoiceMadeDelayed(){this.choiceMadeForPriceCalculated=!0}}